embedded_svc.defineFeature("Invite",function(f){function J(a){var b;if(void 0!==a.style.animationName)return"";["Webkit","Moz","O","ms","Khtml"].forEach(function(c){void 0!==a.style[c+"AnimationName"]&&(b=c.toLowerCase())});return b}function K(a,b,c){if(a.addEventListener)a.addEventListener(b,c,!1);else if(a.attachEvent)a.attachEvent("on"+b,c,!1);else throw Error("Could not add event listener");}function p(){}function n(){}function e(){}function B(a){this.ruleId=a;n.prototype.init.call(this,null,
null)}function C(a,b){n.prototype.init.call(this,a,b)}function D(a,b){n.prototype.init.call(this,a,b)}function E(a){n.prototype.init.call(this,a,null)}function w(a){return m(a)?m(a).getTracker():null}function k(){}function t(a,b,c,d){k.prototype.init.call(this,a,b,c,d)}function u(a,b,c,d){k.prototype.init.call(this,a,b,null,d)}function x(a,b,c,d){k.prototype.init.call(this,a,b,null,d)}function g(a){p.prototype.init.call(this,a,p.TYPE.INVITE);this.active=!1;this.filterLogic=null;this.rules={};this.autoRejectTimeout=
this.inviteTimeout=this.inviteDelay=this.ruleTree=null}function m(a){F[a]||(F[a]=new g(a));return F[a]}function y(a,b,c,d,h){e.prototype.init.call(this,a,b,c,d,h)}function z(a,b,c,d,h){e.prototype.init.call(this,a,b,c,d,h)}function G(a,b,c,d,h){e.prototype.init.call(this,a,b,c,d,h)}function r(a){var b=0,c=0,d;L+=1;if(1E3<L)throw Error("Error processing rule filter logic, preventing recursion");for(d=0;d<a.length;d+=1)"("===a.charAt(d)?c+=1:")"===a.charAt(d)&&--c,","===a.charAt(d)&&1===c&&(b=d);if(0===
a.indexOf("AND("))return c=r(a.substring(4,b)),a=r(a.substring(b+1,a.length-1)),new C(c,a);if(0===a.indexOf("OR("))return c=r(a.substring(3,b)),a=r(a.substring(b+1,a.length-1)),new D(c,a);if(0===a.indexOf("NOT("))return c=r(a.substring(4,a.length-1)),new E(c);if(!isNaN(parseInt(a,10)))return new B(parseInt(a,10));throw Error("Encountered unexpected character in filter logic");}function q(a,b,c,d,h,l,M,N){this.buttonId=a;this.element=b;this.hasInviteAfterAccept=l;this.hasInviteAfterReject=M;this.rejectTime=
N;null===J(b)?this.renderer=new g.RENDERER.Appear.RenderClass(a,b,g.START_POSITION[d],g.END_POSITION[h]):this.renderer=new g.RENDERER[c].RenderClass(a,b,g.START_POSITION[d],g.END_POSITION[h])}var H=!1,I={},v={},F={},L=0,A=new function(){this.init=function(){var a=parseInt(window.localStorage.getItem("snapinsPc"),10)||0;window.localStorage.getItem("snapinsStart")||window.localStorage.setItem("snapinsStart",(new Date).getTime().toString());window.localStorage.setItem("snapinsPc",(a+1).toString());window.localStorage.setItem("snapinsPage_"+
a.toString(),window.location.href);window.localStorage.setItem("snapinsPageTime_"+a.toString(),(new Date).getTime())};this.getPageCount=function(){return parseInt(window.localStorage.getItem("snapinsPc"),10)};this.getSessionStart=function(){return window.localStorage.getItem("snapinsStart")};this.getCurrentPage=function(){return window.localStorage.getItem("snapinsPage_"+(this.getPageCount()-1).toString())}};p.TYPE={STANDARD:"STANDARD",INVITE:"INVITE",AGENT:"AGENT"};p.prototype.init=function(a,b){this.buttonId=
a;this.type=b;this.onlineState=void 0;this.trackers=[]};p.prototype.getType=function(){return this.type};p.prototype.getOnlineState=function(){return this.onlineState};p.prototype.setOnlineState=function(a){this.onlineState=a;this.trackers.forEach(function(b){b.setState(a)})};n.prototype.init=function(a,b){this.left=a;this.right=b};n.prototype.evaluate=function(a){return!1};e.TYPE={NUMBER_OF_PAGE_VIEWS:"NUMBER_OF_PAGE_VIEWS",URL_MATCH:"URL_MATCH",SECONDS_ON_PAGE:"SECONDS_ON_PAGE",SECONDS_ON_SITE:"SECONDS_ON_SITE",
CUSTOM_VARIABLE:"CUSTOM_VARIABLE"};e.OPERATOR={EQUALS:"EQUALS",NOT_EQUAL:"NOT_EQUAL",START_WITH:"START_WITH",CONTAINS:"CONTAINS",NOT_CONTAIN:"NOT_CONTAIN",LESS_THAN:"LESS_THAN",GREATER_THAN:"GREATER_THAN",LESS_OR_EQUAL:"LESS_OR_EQUAL",GREATER_OR_EQUAL:"GREATER_OR_EQUAL"};e.prototype.init=function(a,b,c,d,h){this.ruleId=a;this.buttonId=b;this.compareFrom=c;this.operator=d;this.compareTo=h};e.prototype.getId=function(){return this.ruleId};e.prototype.evaluate=function(a,b){switch(this.operator){case e.OPERATOR.EQUALS:return f.log("Evaluate: "+
a+" == "+b),a===b;case e.OPERATOR.NOT_EQUAL:return f.log("Evaluate: "+a+" != "+b),a!==b;case e.OPERATOR.START_WITH:return f.log("Evaluate: "+a+" indexOf "+b+" == 0"),0===a.indexOf(b);case e.OPERATOR.CONTAINS:return f.log("Evaluate: "+a+" indexOf "+b+" != -1"),-1!==a.indexOf(b);case e.OPERATOR.NOT_CONTAIN:return f.log("Evaluate: "+a+" indexOf "+b+" == -1"),-1===a.indexOf(b);case e.OPERATOR.LESS_THAN:return f.log("Evaluate: "+parseFloat(a)+" < "+parseFloat(b)),parseFloat(a)<parseFloat(b);case e.OPERATOR.GREATER_THAN:return f.log("Evaluate: "+
parseFloat(a)+" > "+parseFloat(b)),parseFloat(a)>parseFloat(b);case e.OPERATOR.LESS_OR_EQUAL:return f.log("Evaluate: "+parseFloat(a)+" <= "+parseFloat(b)),parseFloat(a)<=parseFloat(b);case e.OPERATOR.GREATER_OR_EQUAL:return f.log("Evaluate: "+parseFloat(a)+" >= "+parseFloat(b)),parseFloat(a)>=parseFloat(b)}};B.prototype=new n;B.prototype.evaluate=function(a){f.log("Evaluating Atom Node: "+this.ruleId);return a.getRule(this.ruleId).evaluate()};C.prototype=new n;C.prototype.evaluate=function(a){f.log("Evaluating And Node");
return this.left.evaluate(a)&&this.right.evaluate(a)};D.prototype=new n;D.prototype.evaluate=function(a){a=this.left.evaluate(a)||this.right.evaluate(a);f.log("Evaluating Or Node");return a};E.prototype=new n;E.prototype.evaluate=function(a){a=!this.left.evaluate(a);f.log("Evaluating Not Node");return a};k.prototype.init=function(a,b,c,d){window.innerWidth?this.realWidth=window.innerWidth:document.documentElement&&document.documentElement.clientWidth?this.realWidth=document.documentElement.clientWidth:
document.body&&(this.realWidth=document.body.clientWidth);window.innerHeight?this.realHeight=window.innerHeight:document.documentElement&&document.documentElement.clientHeight?this.realHeight=document.documentElement.clientHeight:document.body&&(this.realHeight=document.body.clientHeight);this.offset=25;this.buttonId=a;this.animationPrefix=J(b);this.element=b;this.element.style.position=this.animationPrefix?"fixed":"absolute";this.element.style.left="-1000px";this.element.style.top="-1000px";this.element.style.zIndex=
"10000";this.element.style.display="";this.element.style.visibility="visible";this.width=this.element.offsetWidth;this.height=this.element.offsetHeight;this.startPosition=c;this.endPosition=d};k.prototype.render=function(){this.element.style.display=""};k.prototype.renderFinish=function(){};k.prototype.remove=function(a){this.element.style.left="-1000px";this.element.style.top="-1000px"};k.prototype.addRenderListeners=function(){var a=this.buttonId,b="AnimationIteration",c="AnimationEnd";""===this.animationPrefix?
(b=b.toLowerCase(),c=c.toLowerCase()):(b=this.animationPrefix+b,c=this.animationPrefix+c);K(this.element,b,function(){w(a).renderFinish()});K(this.element,c,function(){w(a).removeFinish()})};t.prototype=new k;t.prototype.render=function(){var a=this.width*this.startPosition.xPosition+this.offset*this.startPosition.xOffset,b=this.height*this.startPosition.yPosition+this.offset*this.startPosition.yOffset,c=this.width*this.endPosition.xPercent*-1+this.offset*this.endPosition.xOffset,d=this.height*this.endPosition.yPercent*
-1+this.offset*this.endPosition.yOffset,h=document.createElement("style"),l="";k.prototype.addRenderListeners.call(this);""!==this.animationPrefix&&(l="-"+this.animationPrefix+"-");h.innerHTML="@"+l+"keyframes slide"+this.buttonId+"{from { margin-left: "+a+"px; margin-top: "+b+"px; left: "+100*this.startPosition.xPercent+"%; top: "+100*this.startPosition.yPercent+"%; }to { margin-left: "+c+"px; margin-top: "+d+"px; left: "+100*this.endPosition.xPercent+"%; top: "+100*this.endPosition.yPercent+"%; }}";
document.getElementsByTagName("head")[0].appendChild(h);this.element.style[l+"animation-name"]="slide"+this.buttonId;this.element.style[l+"animation-duration"]="1s";this.element.style[l+"animation-iteration-count"]="2";this.element.style[l+"animation-direction"]="alternate";this.element.style[l+"animation-timing-function"]="ease-in-out";this.element.style.setProperty(l+"animation-name","slide"+this.buttonId,"");this.element.style.setProperty(l+"animation-duration","1s","");this.element.style.setProperty(l+
"animation-iteration-count","2","");this.element.style.setProperty(l+"animation-direction","alternate","");this.element.style.setProperty(l+"animation-timing-function","ease-in-out","");k.prototype.render.call(this)};t.prototype.renderFinish=function(){var a="";""!==this.animationPrefix&&(a="-"+this.animationPrefix+"-");this.element.style[a+"animation-play-state"]="paused";this.element.style.setProperty(a+"animation-play-state","paused","")};t.prototype.remove=function(a){var b="";""!==this.animationPrefix&&
(b="-"+this.animationPrefix+"-");a?(this.element.style[b+"animation-play-state"]="running",this.element.style.setProperty(b+"animation-play-state","running","")):(this.element.style[b+"animation-name"]="",this.element.style.setProperty(b+"animation-name","",""),k.prototype.remove.call(this,a))};u.prototype=new k;u.prototype.render=function(){var a="",b=document.createElement("style"),c=this.width*this.endPosition.xPercent*-1+this.offset*this.endPosition.xOffset,d=this.height*this.endPosition.yPercent*
-1+this.offset*this.endPosition.yOffset;k.prototype.addRenderListeners.call(this);""!==this.animationPrefix&&(a="-"+this.animationPrefix+"-");b.innerHTML="@"+a+"keyframes fade"+this.buttonId+"{from { opacity: 0; }to { opacity: 1; }}";document.getElementsByTagName("head")[0].appendChild(b);this.element.style[a+"animation-name"]="fade"+this.buttonId;this.element.style[a+"animation-duration"]="1s";this.element.style[a+"animation-iteration-count"]="2";this.element.style[a+"animation-direction"]="alternate";
this.element.style[a+"animation-timing-function"]="ease-in-out";this.element.style.setProperty(a+"animation-name","fade"+this.buttonId,"");this.element.style.setProperty(a+"animation-duration","1s","");this.element.style.setProperty(a+"animation-iteration-count","2","");this.element.style.setProperty(a+"animation-direction","alternate","");this.element.style.setProperty(a+"animation-timing-function","ease-in-out","");this.element.style.marginLeft=c+"px";this.element.style.left=100*this.endPosition.xPercent+
"%";this.element.style.marginTop=d+"px";this.element.style.top=100*this.endPosition.yPercent+"%";k.prototype.render.call(this)};u.prototype.renderFinish=function(){var a="";""!==this.animationPrefix&&(a="-"+this.animationPrefix+"-");this.element.style[a+"animation-name"]="";this.element.style.setProperty(a+"animation-name","","")};u.prototype.remove=function(a){var b="";""!==this.animationPrefix&&(b="-"+this.animationPrefix+"-");a?(this.element.style[b+"animation-play-state"]="running",this.element.style.setProperty(b+
"animation-play-state","running",""),this.element.style.opacity=0):(this.element.style[b+"animation-name"]="",this.element.style.setProperty(b+"animation-name","",""),k.prototype.remove.call(this,a))};x.prototype=new k;x.prototype.render=function(){var a=this.height*this.endPosition.yPercent*-1+this.offset*this.endPosition.yOffset;this.element.style.marginLeft=this.width*this.endPosition.xPercent*-1+this.offset*this.endPosition.xOffset+"px";this.element.style.left=100*this.endPosition.xPercent+"%";
this.element.style.marginTop=a+"px";this.element.style.top=100*this.endPosition.yPercent+"%";k.prototype.render.call(this);w(this.buttonId).renderFinish()};x.prototype.remove=function(a){a?w(this.buttonId).removeFinish():k.prototype.remove.call(this,a)};g.prototype=new p;g.RENDERER={Slide:{RenderClass:t},Fade:{RenderClass:u},Appear:{RenderClass:x}};g.START_POSITION={TopLeft:{xPercent:0,xPosition:-1,xOffset:-1,yPercent:0,yPosition:-1,yOffset:-1},TopLeftTop:{xPercent:0,xPosition:0,xOffset:1,yPercent:0,
yPosition:-1,yOffset:-1},Top:{xPercent:.5,xPosition:-.5,xOffset:0,yPercent:0,yPosition:-1,yOffset:-1},TopRightTop:{xPercent:1,xPosition:-1,xOffset:-1,yPercent:0,yPosition:-1,yOffset:-1},TopRight:{xPercent:1,xPosition:0,xOffset:1,yPercent:0,yPosition:-1,yOffset:-1},TopRightRight:{xPercent:1,xPosition:0,xOffset:1,yPercent:0,yPosition:0,yOffset:1},Right:{xPercent:1,xPosition:0,xOffset:1,yPercent:.5,yPosition:-.5,yOffset:0},BottomRightRight:{xPercent:1,xPosition:0,xOffset:1,yPercent:1,yPosition:-1,yOffset:-1},
BottomRight:{xPercent:1,xPosition:0,xOffset:1,yPercent:1,yPosition:0,yOffset:1},BottomRightBottom:{xPercent:1,xPosition:-1,xOffset:-1,yPercent:1,yPosition:0,yOffset:1},Bottom:{xPercent:.5,xPosition:-.5,xOffset:0,yPercent:1,yPosition:0,yOffset:1},BottomLeftBottom:{xPercent:0,xPosition:0,xOffset:1,yPercent:1,yPosition:0,yOffset:1},BottomLeft:{xPercent:0,xPosition:-1,xOffset:-1,yPercent:1,yPosition:0,yOffset:1},BottomLeftLeft:{xPercent:0,xPosition:-1,xOffset:-1,yPercent:1,yPosition:-1,yOffset:-1},Left:{xPercent:0,
xPosition:-1,xOffset:-1,yPercent:.5,yPosition:-.5,yOffset:0},TopLeftLeft:{xPercent:0,xPosition:-1,xOffset:-1,yPercent:0,yPosition:0,yOffset:1}};g.END_POSITION={TopLeft:{xPercent:0,xOffset:1,yPercent:0,yOffset:1},Top:{xPercent:.5,xOffset:0,yPercent:0,yOffset:1},TopRight:{xPercent:1,xOffset:-1,yPercent:0,yOffset:1},Left:{xPercent:0,xOffset:1,yPercent:.5,yOffset:0},Center:{xPercent:.5,xOffset:0,yPercent:.5,yOffset:0},Right:{xPercent:1,xOffset:-1,yPercent:.5,yOffset:0},BottomLeft:{xPercent:0,xOffset:1,
yPercent:1,yOffset:-1},Bottom:{xPercent:.5,xOffset:0,yPercent:1,yOffset:-1},BottomRight:{xPercent:1,xOffset:-1,yPercent:1,yOffset:-3}};y.prototype=new e;y.prototype.evaluate=function(){f.log("Evaluating StandardInviteRule");return e.prototype.evaluate.call(this,this.compareFrom,this.compareTo)};z.prototype=new e;z.prototype.evaluate=function(){var a=(new Date).getTime()-this.compareFrom,b=e.prototype.evaluate.call(this,a,this.compareTo);f.log("Evaluating TimerInviteRule");!b&&a<=this.compareTo&&(a=
this.compareTo-a,(null===m(this.buttonId).getInviteDelay()||a<m(this.buttonId).getInviteDelay())&&m(this.buttonId).setInviteDelay(a));return b};G.prototype=new e;G.prototype.evaluate=function(){if(I.hasOwnProperty(this.compareFrom))return f.log("Evaluating CustomInviteRule"),e.prototype.evaluate.call(this,I[this.compareFrom].toString(),this.compareTo);f.log("CustomInviteRule evaluation failed due to missing custom variable");return!1};q.prototype.setState=function(a){a&&!H&&m(this.buttonId).trigger()?
(H=!0,this.renderer.render()):!a&&m(this.buttonId).isActive()&&(H=!1,this.remove(!0))};q.prototype.renderFinish=function(){var a=this.buttonId;m(this.buttonId).setActive(!0);-1!==this.rejectTime&&m(this.buttonId).setAutoRejectTimeout(window.setTimeout(function(){m(a).rejectInvite()},1E3*this.rejectTime));this.renderer.renderFinish()};q.prototype.hasCookieConsent=function(a){var b={liveagent_invite_rejected_:"Preferences"};b=b[a]&&embedded_svc.utils&&embedded_svc.utils.cookie&&embedded_svc.utils.cookie.isCategoryAllowedForCurrentConsent?
embedded_svc.utils.cookie.isCategoryAllowedForCurrentConsent(b[a]):!1;var c=[];a=0>["liveagent_invite_rejected_"].indexOf(a)||0>c.indexOf(window.location.host);return b&&a};q.prototype.accept=function(){!this.hasInviteAfterAccept&&this.hasCookieConsent("liveagent_invite_rejected_")&&f.setCookie("liveagent_invite_rejected_"+this.buttonId,!0,!1);this.remove(!1)};q.prototype.reject=function(){!this.hasInviteAfterReject&&this.hasCookieConsent("liveagent_invite_rejected_")&&f.setCookie("liveagent_invite_rejected_"+
this.buttonId,!0,!1);this.remove(!0)};q.prototype.remove=function(a){m(this.buttonId).setActive(!1);this.renderer.remove(a)};q.prototype.removeFinish=function(){this.renderer.remove(!1)};g.prototype.setRules=function(a,b){var c;if(a&&b){for(c in a)if(a.hasOwnProperty(c)){var d=a[c];var h=null;switch(d.type){case e.TYPE.NUMBER_OF_PAGE_VIEWS:h=new y(d.order,this.buttonId,A.getPageCount(),d.operator,parseInt(d.value,10));break;case e.TYPE.URL_MATCH:h=new y(d.order,this.buttonId,A.getCurrentPage(),d.operator,
d.value);break;case e.TYPE.SECONDS_ON_PAGE:h=new z(d.order,this.buttonId,(new Date).getTime(),d.operator,1E3*parseInt(d.value,10));break;case e.TYPE.SECONDS_ON_SITE:h=new z(d.order,this.buttonId,parseInt(A.getSessionStart(),10),d.operator,1E3*parseInt(d.value,10));break;case e.TYPE.CUSTOM_VARIABLE:h=new G(d.order,this.buttonId,d.name,d.operator,d.value),v.hasOwnProperty(d.name)||(v[d.name]=[]),v[d.name].push(this.buttonId)}null!==h&&this.addRule(h)}this.filterLogic=b;this.ruleTree=r(b)}};g.prototype.setOnlineState=
function(a){a||null===this.inviteTimeout||(clearTimeout(this.inviteTimeout),this.inviteTimeout=null);a||null===this.autoRejectTimeout||(clearTimeout(this.autoRejectTimeout),this.autoRejectTimeout=null);p.prototype.setOnlineState.call(this,a)};g.prototype.isActive=function(){return this.active};g.prototype.setActive=function(a){document.getElementById("snapins_invite")&&(document.getElementById("snapins_invite").inert=!a);this.active=a};g.prototype.addTracker=function(a,b){a=/Mobi/.test(navigator.userAgent)?
new q(b.id,a,"Fade",void 0,"BottomRight",b.hasInviteAfterAccept,b.hasInviteAfterReject,b.inviteRejectTime):new q(b.id,a,b.inviteRenderer,b.inviteStartPosition,b.inviteEndPosition,b.hasInviteAfterAccept,b.hasInviteAfterReject,b.inviteRejectTime);this.trackers=[];this.trackers.push(a)};g.prototype.getTracker=function(){if(1<this.trackers.length)throw Error("InviteButtons should have less than 1 tracker");return this.trackers[0]};g.prototype.acceptInvite=function(){f.onHelpButtonClick();this.getTracker().accept();
embedded_svc.utils.fireEvent("onInviteAccepted")};g.prototype.rejectInvite=function(){this.getTracker().reject();embedded_svc.utils.fireEvent("onInviteRejected")};g.prototype.setCustomVariable=function(a,b){var c;I[a]=b;v.hasOwnProperty(a)&&v[a].forEach(function(d){c=m(d);c.getOnlineState()&&c.setOnlineState(!0)})};g.prototype.trigger=function(){var a=!0,b=this,c=f.componentInitInProgress||0<document.getElementsByClassName("embeddedServiceSidebar").length;if(f.getCookie("liveagent_invite_rejected_"+
this.buttonId)||c)return!1;null!==this.ruleTree&&(f.log("Invite "+this.buttonId+" Rule Evaluation"),f.log("Filter Logic: "+this.filterLogic),a=this.ruleTree.evaluate(this));a||null===this.inviteDelay||(this.inviteTimeout=window.setTimeout(function(){b.setOnlineState(!0)},this.inviteDelay),this.inviteDelay=null);return a};g.prototype.addRule=function(a){this.rules[a.getId()]=a};g.prototype.getRule=function(a){return this.rules[a]};g.prototype.getInviteDelay=function(){return this.inviteDelay};g.prototype.setInviteDelay=
function(a){f.log("Setting invite delay to: "+a);this.inviteDelay=a};g.prototype.setAutoRejectTimeout=function(a){this.autoRejectTimeout=a};f.inviteAPI=new function(){this.inviteButton=m(f.settings.buttonId);A.init();if(document.getElementById("embeddedServiceAvatar"))if(embedded_svc.settings.avatarImgURL)document.getElementById("embeddedServiceAvatar").src=embedded_svc.settings.avatarImgURL;else{var a=document.getElementById("embeddedServiceAvatar");a.parentNode.removeChild(a)}}});
